<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>BasicApplicationInterface: Librairie bai (Basic Application Interface)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BasicApplicationInterface
   </div>
   <div id="projectbrief">Easy toolbox for basic application development.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Librairie bai (Basic Application Interface) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>Cette librairie rend disponible des outils simples permettant de créer une application Windows de base.</p>
<h1><a class="anchor" id="sfml"></a>
SFML</h1>
<p>bai s'appuie entièrement sur la librairie <a href="https://www.sfml-dev.org/index.php" target="_blank">SFML</a> . En fait, bai est une "wrapper" simplifiant (et limitant) SFML.</p>
<h1><a class="anchor" id="presentation"></a>
Présentation</h1>
<p>La librairie est constituée de 4 groupes de classes :</p><ul>
<li>classe représentant l'application :<ul>
<li><code>BasicApplicationInterface</code> : gère une application</li>
</ul>
</li>
<li>classes représentant les intrants et extrants de l'application :<ul>
<li><code>InputManager</code> : donne accès au clavier et à la souris</li>
<li><code>Surface</code> : donne accès au canevas de l'application pour y dessiner</li>
</ul>
</li>
<li>ressources :<ul>
<li><code>Font</code> : police de caractère (doit utiliser un fichier externe)</li>
<li><code>TextStyle</code> : caractéristiques visuelles d'un texte (doit utiliser un objet de la classe Font)</li>
<li><code>Image</code> : image (doit utiliser un fichier externe)</li>
<li><code>Sprite</code> : sous-image (doit utiliser un objet de la classe Image)</li>
</ul>
</li>
<li>classes utilitaires :<ul>
<li><code>Point</code> : P<code>ointInt</code> et <code>PointReal</code></li>
<li><code>Size</code> : <code>SizeInt</code> et <code>SizeReal</code></li>
<li><code>Rect</code> : <code>RectInt</code> et <code>RectReal</code></li>
<li><code>Color</code></li>
</ul>
</li>
</ul>
<p>L'idée est simple, il suffit de créer une fonction de rappel (<code>callback function</code>) et de l'assigner à un objet de la classe <code>BasicApplicationInterface</code> (<code>BasicApplicationInterface::registerLoop</code>). Lorsque l'application est lancée (<code>BasicApplicationInterface::run</code>), l'application appel la fonction de rappel avec trois paramètres :</p><ul>
<li>le temps écoulé</li>
<li>le gestionnaire d'entrées (<code>InputManager</code>)</li>
<li>la surface (<code>Surface</code>) Ainsi, il suffit de réaliser la gestion des entrées et de l'affichage dans la fonction de rappel.</li>
</ul>
<p>Il existe deux surcharges de la méthodes <code>registerLoop</code> :</p><ul>
<li>une fonction conventionnelle via un pointeur de fonction</li>
<li>une fonction de classe et un objet</li>
</ul>
<h1><a class="anchor" id="config"></a>
Configuration</h1>
<ol type="1">
<li>créer un projet vide dans Visual Studio (pour la suite de cette documentation, on considère le projet <code>pro</code> dans la solution <code>sol</code> - <code>c:\chemin\sol\pro\</code>)</li>
<li>ajouter un fichier <code>pro.cpp</code> dans lequel se trouvera la fonction main.</li>
<li>décompresser et copier le contenu du fichier <code>bai.zip</code> dans le dossier source de la solution (<code>c:\chemin\sol\</code>). Vous aurez ainsi le dossier <code>c:\chemin\sol\dev\</code> et les sous dossiers suivants :<ul>
<li><code>doc</code> : la documentation doxygen de la librairie bai</li>
<li><code>include</code> : les fichiers d'entête</li>
<li><code>lib</code> : les fichiers de la librairie</li>
</ul>
</li>
<li>dans les options de VS :<ul>
<li>All configurations :<ul>
<li>C/C++ | General | Additional Include Directories : <code>..\dev\include</code></li>
<li>C/C++ | Language | C++ Language Standard : <code>ISO C++ Latest Draft Standard (/std:c++latest)</code></li>
<li>Linker | General | Additional Library Directories : <code>..\dev\lib</code></li>
</ul>
</li>
<li>Debug :<ul>
<li>Linker | Input | Additional Dependencies : <code>baid.lib</code></li>
</ul>
</li>
<li>Release :<ul>
<li>Linker | Input | Additional Dependencies : <code>bai.lib</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="examples"></a>
Exemples</h1>
<p>Trois exemples sont présentés.</p>
<h2><a class="anchor" id="example1"></a>
Exemple 1</h2>
<p>Ce premier exemple présente une application simple permettant de manipuler une forme (position, couleur et forme). La fonction de rappel est une fonction "callback" traditionnelle.</p>
<div class="fragment"><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;bai&gt;</span>                              <span class="comment">// Inclusion complète de la librairie bai</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacebai.html">bai</a>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Déclaration et implémentation de la fonction de rappel.</span></div><div class="line"><span class="comment"></span><span class="keywordtype">bool</span> callbackFunction(<span class="keywordtype">float</span> elapsedTime, <a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager, <a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface)</div><div class="line">{</div><div class="line">    <span class="comment">// Constantes statiques</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> offsetPosition{ 5.0f };</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> offsetColor{ 5 };</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> radius{ 50.0f };</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> thresholdTime{ 0.033f };</div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classbai_1_1_color.html">Color</a> borderColor(<a class="code" href="classbai_1_1_color.html#a37fb51e9bc73e6ca628d94a18586db9a">Color::white</a>);</div><div class="line">    <span class="comment">// Variables statiques</span></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> keyEnterDown{ <span class="keyword">false</span> };</div><div class="line">    <span class="keyword">static</span> <a class="code" href="classbai_1_1_point.html">PointReal</a> position(400.0f, 300.0f);</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> circle{ <span class="keyword">true</span> };</div><div class="line">    <span class="keyword">static</span> <a class="code" href="classbai_1_1_color.html">Color</a> color(128, 128, 128);</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">float</span> cumulativeTime{};</div><div class="line"></div><div class="line">    <span class="comment">// Valide le délais passé</span></div><div class="line">    cumulativeTime += elapsedTime;</div><div class="line">    <span class="keywordflow">if</span> (cumulativeTime &gt;= thresholdTime) {</div><div class="line">        cumulativeTime = 0.0f;</div><div class="line"></div><div class="line">        <span class="comment">// Effectue les actions liées aux touches du clavier</span></div><div class="line">        <span class="keywordflow">if</span> (inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Left))     position.setX(position.x() - offsetPosition);           <span class="comment">// bouge à gauche</span></div><div class="line">        <span class="keywordflow">if</span> (inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Up))       position.setY(position.y() - offsetPosition);           <span class="comment">// bouge vers le haut</span></div><div class="line">        <span class="keywordflow">if</span> (inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Right))    position.setX(position.x() + offsetPosition);           <span class="comment">// bouge vers la droite</span></div><div class="line">        <span class="keywordflow">if</span> (inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Down))     position.setY(position.y() + offsetPosition);           <span class="comment">// bouge vers le bas</span></div><div class="line">        <span class="keywordflow">if</span> (inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::R))        color.setRed((color.getRed() + offsetColor) % 256);     <span class="comment">// change la composante rouge de la couleur</span></div><div class="line">        <span class="keywordflow">if</span> (inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::G))        color.setGreen((color.getGreen() + offsetColor) % 256); <span class="comment">// change la composante verte de la couleur</span></div><div class="line">        <span class="keywordflow">if</span> (inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::B))        color.setBlue((color.getBlue() + offsetColor) % 256);   <span class="comment">// change la composante bleue de la couleur</span></div><div class="line">        <span class="keywordflow">if</span> (inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Space))    color.randomize(128, 255, <span class="keyword">true</span>);                        <span class="comment">// détermine la couleur aléatoirement</span></div><div class="line">        <span class="keywordflow">if</span> (inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Enter)) {                                                          <span class="comment">// change de forme : cercle &lt;==&gt; triangle</span></div><div class="line">            <span class="keywordflow">if</span> (keyEnterDown == <span class="keyword">false</span>) {</div><div class="line">                keyEnterDown = <span class="keyword">true</span>;</div><div class="line">                circle = !circle;</div><div class="line">            }</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            keyEnterDown = <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Dessine</span></div><div class="line">    surface.<a class="code" href="classbai_1_1_surface.html#aa28d529e12374c0d25b4e63739c34d82">clear</a>(<a class="code" href="classbai_1_1_color.html#a2285200634eb541c0750b4a35a01ff71">Color::black</a>);</div><div class="line">    <span class="keywordflow">if</span> (circle) {</div><div class="line">        surface.<a class="code" href="classbai_1_1_surface.html#a8889a9495cae60c6bb60705fb10639bb">drawCircle</a>(position, radius, color, borderColor);                   <span class="comment">// Dessine un cercle</span></div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        surface.<a class="code" href="classbai_1_1_surface.html#a19b7fc046d752c99b60376f6561340a0">drawRegularPolygon</a>(position, radius, 3, 0.0f, color, borderColor);  <span class="comment">// Dessine un triangle</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Est-ce que l&#39;usager désire poursuivre</span></div><div class="line">    <span class="keywordflow">return</span> !inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Q);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Point d&#39;entrée du programme</span></div><div class="line"><span class="comment"></span><span class="keywordtype">int</span> WinMain()</div><div class="line">{</div><div class="line">    <span class="comment">// Crée l&#39;application</span></div><div class="line">    <a class="code" href="classbai_1_1_basic_application_interface.html">BasicApplicationInterface</a> app(800, 600, <span class="stringliteral">&quot;BAI exemple simple&quot;</span>);</div><div class="line">    </div><div class="line">    <span class="comment">// Détermine la fonction de rappel (callback).</span></div><div class="line">    app.registerLoop(callbackFunction);</div><div class="line"></div><div class="line">    <span class="comment">// Exécute l&#39;application.</span></div><div class="line">    app.run();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="example2"></a>
Exemple 2</h2>
<p>Ce deuxième exemple présente une application permettant de tester les entrées (clavier et souris). Plusieurs classes utilitaires sont créées afin de simplifier l'analyse des entrées et la présentation. Une classe encapsule la fonction de rappel.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;bai&gt;</span>              <span class="comment">// Inclusion complète de la librairie bai</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacebai.html">bai</a>;</div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Classe utilitaire abstraite servant à afficher le résultat d&#39;un test </span></div><div class="line"><span class="comment">// lié au InputManager. L&#39;affichage se fait par une zone rectangulaire </span></div><div class="line"><span class="comment">// et un texte changeant de style selon le test réalisé.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// La fonction test est réalisé par polymorphisme en retournant un bool.</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// La sous classe Appearance sert à encapsuler les informations </span></div><div class="line"><span class="comment">// visuelles.</span></div><div class="line"><span class="comment"></span><span class="keyword">class </span>TestBox</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Classe interne servant à encapsuler les informations visuelles.</span></div><div class="line">    <span class="keyword">struct </span>Appearance {</div><div class="line">        Appearance(<a class="code" href="classbai_1_1_text_style.html">TextStyle</a> &amp; activeStyle, <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> &amp; inactiveStyle);</div><div class="line"></div><div class="line">        <a class="code" href="classbai_1_1_color.html">Color</a> fillColor;                        <span class="comment">// couleur de remplissage de la boîte</span></div><div class="line">        <a class="code" href="classbai_1_1_color.html">Color</a> outlineColor;                     <span class="comment">// couleur du contour de la boîte</span></div><div class="line">        <span class="keywordtype">float</span> outlineThickness{ 1.0f };         <span class="comment">// épaisseur du contour</span></div><div class="line">        <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> textActiveStyle;              <span class="comment">// style pour le texte répondant true au test</span></div><div class="line">        <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> textInactiveStyle;            <span class="comment">// style pour le texte répondant false au test</span></div><div class="line"></div><div class="line">        <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> &amp; textStyle(<span class="keywordtype">bool</span> active);     <span class="comment">// retourne le style approprié</span></div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="comment">// Constructeur avec plusieurs paramètres obligatoire dès la création.</span></div><div class="line">    TestBox(<a class="code" href="classbai_1_1_rect.html">RectInt</a> <span class="keyword">const</span> &amp; rect, std::string <span class="keyword">const</span> &amp; text, Appearance <span class="keyword">const</span> &amp; appearance, <span class="keywordtype">bool</span> active = <span class="keyword">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Mutateur de l&#39;état</span></div><div class="line">    <span class="keywordtype">void</span> setState(<span class="keywordtype">bool</span> active);</div><div class="line"></div><div class="line">    <span class="comment">// Mutateur du texte </span></div><div class="line">    <span class="keywordtype">void</span> setText(std::string <span class="keyword">const</span> &amp; text);</div><div class="line"></div><div class="line">    <span class="comment">// Fonction faisant l&#39;appel du test et réalisant l&#39;affichage</span></div><div class="line">    <span class="keywordtype">bool</span> test(<span class="keywordtype">float</span> elapsedTime, <a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager, <a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface);</div><div class="line"></div><div class="line">    <span class="comment">// Fonction abstraite réalisant le test. Doit être réimplémentée.</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> doTest(<a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager) = 0;</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="keywordtype">bool</span> mActive;               <span class="comment">// dernier résutat du test effectué</span></div><div class="line">    <a class="code" href="classbai_1_1_rect.html">RectInt</a> mRect;              <span class="comment">// zone rectangulaire représentant la boîte à l&#39;écran</span></div><div class="line">    std::string mText;          <span class="comment">// texte afficher à l&#39;écran</span></div><div class="line">    Appearance mAppearance;     <span class="comment">// informations visuelles</span></div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Classe réalisant un test de bouton pour la souris.</span></div><div class="line"><span class="comment"></span><span class="keyword">class </span>MouseButtonTest : <span class="keyword">public</span> TestBox</div><div class="line">{</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="comment">// Le bouton de la souris à tester.</span></div><div class="line">    <a class="code" href="classbai_1_1_input_manager.html#aeb26e9f6e30ffda2bab2d4af227bfc5f">InputManager::MouseButton</a> mButtonToTest;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Constructeur avec plusieurs paramètres obligatoire dès la création.</span></div><div class="line">    MouseButtonTest(<a class="code" href="classbai_1_1_input_manager.html#aeb26e9f6e30ffda2bab2d4af227bfc5f">InputManager::MouseButton</a> buttonToTest, <a class="code" href="classbai_1_1_rect.html">RectInt</a> <span class="keyword">const</span> &amp; rect, std::string <span class="keyword">const</span> &amp; text, Appearance <span class="keyword">const</span> &amp; appearance, <span class="keywordtype">bool</span> state = <span class="keyword">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Fonction substitue pour la réalisation du test.</span></div><div class="line">    <span class="keywordtype">bool</span> doTest(<a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager) <span class="keyword">override</span>;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// Classe réalisant un test de clavier.</span></div><div class="line"><span class="comment"></span><span class="keyword">class </span>KeyTest : <span class="keyword">public</span> TestBox</div><div class="line">{</div><div class="line">    <span class="comment">// La touche à tester.</span></div><div class="line">    <a class="code" href="classbai_1_1_input_manager.html#a7be4e5294562135f971cbf2b2336b9f6">InputManager::Key</a> mKeyToTest;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Constructeur avec plusieurs paramètres obligatoire dès la création.</span></div><div class="line">    KeyTest(<a class="code" href="classbai_1_1_input_manager.html#a7be4e5294562135f971cbf2b2336b9f6">InputManager::Key</a> keyToTest, <a class="code" href="classbai_1_1_rect.html">RectInt</a> <span class="keyword">const</span> &amp; rect, std::string <span class="keyword">const</span> &amp; text, Appearance <span class="keyword">const</span> &amp; appearance, <span class="keywordtype">bool</span> state = <span class="keyword">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Fonction substitue pour la réalisation du test.</span></div><div class="line">    <span class="keywordtype">bool</span> doTest(<a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager) <span class="keyword">override</span>;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// Classe réalisant un test de clavier.</span></div><div class="line"><span class="comment"></span><span class="keyword">class </span>HasFocusTest : <span class="keyword">public</span> TestBox</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Constructeur avec plusieurs paramètres obligatoire dès la création.</span></div><div class="line">    HasFocusTest(<a class="code" href="classbai_1_1_rect.html">RectInt</a> <span class="keyword">const</span> &amp; rect, Appearance <span class="keyword">const</span> &amp; appearance, <span class="keywordtype">bool</span> state = <span class="keyword">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Fonction substitue pour la réalisation du test.</span></div><div class="line">    <span class="keywordtype">bool</span> doTest(<a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager) <span class="keyword">override</span>;</div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Classe faisant la gestion de plusieurs tests.</span></div><div class="line"><span class="comment">// Possède plusieurs TestBox et en fait une gestion complète.</span></div><div class="line"><span class="comment">// Possède aussi la boucle de traitement principale pour cette </span></div><div class="line"><span class="comment">// application bai.</span></div><div class="line"><span class="comment"></span><span class="keyword">class </span>TestManager</div><div class="line">{</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="comment">// La liste de tous les tests.</span></div><div class="line">    std::list&lt;TestBox*&gt; mTests;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Le destructeur vide toute la mémoire propriétaire.</span></div><div class="line">    ~TestManager();</div><div class="line"></div><div class="line">    <span class="comment">// Ajoute un test. Le test doit être alloué dynamiquement (polymorphisme) </span></div><div class="line">    <span class="comment">// et devient la propriété de TestManager.</span></div><div class="line">    <span class="keywordtype">void</span> addTest(TestBox * test);</div><div class="line"></div><div class="line">    <span class="comment">// Fonction de rappel (callback) réalisant les tests et les affichages.</span></div><div class="line">    <span class="keywordtype">bool</span> test(<span class="keywordtype">float</span> elapsedTime, <a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager, <a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface);</div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdexcept&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Point d&#39;entrée du programme</span></div><div class="line"><span class="comment"></span><span class="keywordtype">int</span> WinMain()</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        <span class="comment">// Crée l&#39;application</span></div><div class="line">        <a class="code" href="classbai_1_1_basic_application_interface.html">BasicApplicationInterface</a> <a class="code" href="namespacebai.html">bai</a>(1200, 800, <span class="stringliteral">&quot;BAI test application!&quot;</span>);</div><div class="line">        <span class="comment">// Crée le gestionnaire de tests</span></div><div class="line">        TestManager testManager;</div><div class="line"></div><div class="line">        <span class="comment">// Crée les ressources (attention, il faut que le fichier soit présent dans le dossier d&#39;exécution)</span></div><div class="line">        <a class="code" href="classbai_1_1_font.html">Font</a> arialFont(<span class="stringliteral">&quot;arial.ttf&quot;</span>);</div><div class="line">        <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> testStyleActive(arialFont, 18, <a class="code" href="classbai_1_1_color.html#a1d494cf27aa9e877f137a0dab7ed222c">Color::darkGrey</a>, <span class="keyword">true</span>);</div><div class="line">        <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> testStyleInactive(arialFont, 18, <a class="code" href="classbai_1_1_color.html#afd823840c9be1df602085de4a437751d">Color::mediumDarkGrey</a>, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Crée les paramètres visuels</span></div><div class="line">        TestBox::Appearance look(testStyleActive, testStyleInactive);</div><div class="line">        look.outlineThickness = 2.0f;</div><div class="line"></div><div class="line">        <a class="code" href="classbai_1_1_size.html">SizeInt</a> boxSize(125, 35);</div><div class="line">        <span class="keywordtype">int</span> offset{ 8 };</div><div class="line">        <a class="code" href="classbai_1_1_point.html">PointInt</a> origin(10, 10);</div><div class="line">        <a class="code" href="classbai_1_1_point.html">PointInt</a> hOffset(boxSize.width() + offset, 0);</div><div class="line">        <a class="code" href="classbai_1_1_point.html">PointInt</a> vOffset(0, boxSize.height() + offset);</div><div class="line">        <a class="code" href="classbai_1_1_rect.html">RectInt</a> rect(origin, boxSize);</div><div class="line"></div><div class="line">        <span class="comment">// Crée tous les tests pour la souris</span></div><div class="line">        look.fillColor = <a class="code" href="classbai_1_1_color.html">Color</a>(154, 132, 155);</div><div class="line">        look.outlineColor = <a class="code" href="classbai_1_1_color.html">Color</a>(103, 85, 104);</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i{}; i &lt; (int)InputManager::MouseButton::key_count; ++i) {</div><div class="line">            testManager.addTest(<span class="keyword">new</span> MouseButtonTest(    (<a class="code" href="classbai_1_1_input_manager.html#aeb26e9f6e30ffda2bab2d4af227bfc5f">InputManager::MouseButton</a>)i, </div><div class="line">                                                        rect + i * vOffset, </div><div class="line">                                                        InputManager::mouseButtonText((<a class="code" href="classbai_1_1_input_manager.html#aeb26e9f6e30ffda2bab2d4af227bfc5f">InputManager::MouseButton</a>)i), </div><div class="line">                                                        look, <span class="keyword">false</span>));</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Crée tous les tests pour le clavier</span></div><div class="line">        look.fillColor = <a class="code" href="classbai_1_1_color.html">Color</a>(153, 168, 189);</div><div class="line">        look.outlineColor = <a class="code" href="classbai_1_1_color.html">Color</a>(98, 119, 151);</div><div class="line">        <span class="keywordtype">int</span> rowCount{ 17 };</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i{ 0 }; i &lt; (int)InputManager::Key::key_count; ++i) {</div><div class="line">            testManager.addTest(<span class="keyword">new</span> KeyTest(    (<a class="code" href="classbai_1_1_input_manager.html#a7be4e5294562135f971cbf2b2336b9f6">InputManager::Key</a>)i, </div><div class="line">                                                rect + (i % rowCount) * vOffset + (i / rowCount + 1) * hOffset, </div><div class="line">                                                InputManager::keyText((<a class="code" href="classbai_1_1_input_manager.html#a7be4e5294562135f971cbf2b2336b9f6">InputManager::Key</a>)i), </div><div class="line">                                                look, <span class="keyword">false</span>));</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Crée le test lié au focus de l&#39;application</span></div><div class="line">        look.fillColor = <a class="code" href="classbai_1_1_color.html">Color</a>(189, 168, 153);</div><div class="line">        look.outlineColor = <a class="code" href="classbai_1_1_color.html">Color</a>(151, 119, 98);</div><div class="line">        testManager.addTest(<span class="keyword">new</span> HasFocusTest(rect + <a class="code" href="classbai_1_1_point.html">PointInt</a>(<a class="code" href="namespacebai.html">bai</a>.size().width() - boxSize.width() - origin.x(), origin.y()), look, <span class="keyword">true</span>));</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">// Détermine la fonction de rappel (callback).</span></div><div class="line">        <a class="code" href="namespacebai.html">bai</a>.registerLoop(testManager, &amp;TestManager::test);</div><div class="line">        <span class="comment">// Exécute l&#39;application.</span></div><div class="line">        <a class="code" href="namespacebai.html">bai</a>.run();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (std::exception e) {</div><div class="line">        std::cout &lt;&lt; e.what();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Implémentation des fonctions</span></div><div class="line"><span class="comment"></span>TestBox::Appearance::Appearance(<a class="code" href="classbai_1_1_text_style.html">TextStyle</a> &amp; activeStyle, <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> &amp; inactiveStyle) </div><div class="line">    : textActiveStyle(activeStyle), textInactiveStyle(inactiveStyle) </div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="classbai_1_1_text_style.html">TextStyle</a> &amp; TestBox::Appearance::textStyle(<span class="keywordtype">bool</span> active) </div><div class="line">{ </div><div class="line">    <span class="keywordflow">return</span> active ? textActiveStyle : textInactiveStyle; </div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">TestBox::TestBox(<a class="code" href="classbai_1_1_rect.html">RectInt</a> <span class="keyword">const</span> &amp; rect, std::string <span class="keyword">const</span> &amp; text, Appearance <span class="keyword">const</span> &amp; appearance, <span class="keywordtype">bool</span> active)</div><div class="line">    : mRect(rect), mText(text), mAppearance(appearance), mActive{ active }</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TestBox::setState(<span class="keywordtype">bool</span> active) </div><div class="line">{</div><div class="line">    mActive = active;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TestBox::setText(std::string <span class="keyword">const</span> &amp; text) </div><div class="line">{</div><div class="line">    mText = text;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> TestBox::test(<span class="keywordtype">float</span> elapsedTime, <a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager, <a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface) </div><div class="line">{</div><div class="line">    mActive = doTest(inputManager);</div><div class="line">    surface.<a class="code" href="classbai_1_1_surface.html#a1d1637f0372b0db46e7992d93b71f5a7">drawRectangle</a>(mRect, mAppearance.fillColor, mAppearance.outlineColor, mAppearance.outlineThickness);</div><div class="line">    surface.<a class="code" href="classbai_1_1_surface.html#a21bf2906a4f062c434a4931c50fa2f5a">drawCenteredText</a>(mAppearance.textStyle(mActive), mText, mRect.center(), 0.0f);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">MouseButtonTest::MouseButtonTest(<a class="code" href="classbai_1_1_input_manager.html#aeb26e9f6e30ffda2bab2d4af227bfc5f">InputManager::MouseButton</a> buttonToTest, <a class="code" href="classbai_1_1_rect.html">RectInt</a> <span class="keyword">const</span> &amp; rect, std::string <span class="keyword">const</span> &amp; text, Appearance <span class="keyword">const</span> &amp; appearance, <span class="keywordtype">bool</span> state)</div><div class="line">    : TestBox(rect, text, appearance, state), mButtonToTest{ buttonToTest }</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> MouseButtonTest::doTest(<a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> inputManager.<a class="code" href="classbai_1_1_input_manager.html#a4429c207e466244545dd8d8b41e35526">isMouseButtonPressed</a>(mButtonToTest);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">KeyTest::KeyTest(<a class="code" href="classbai_1_1_input_manager.html#a7be4e5294562135f971cbf2b2336b9f6">InputManager::Key</a> keyToTest, <a class="code" href="classbai_1_1_rect.html">RectInt</a> <span class="keyword">const</span> &amp; rect, std::string <span class="keyword">const</span> &amp; text, Appearance <span class="keyword">const</span> &amp; appearance, <span class="keywordtype">bool</span> state)</div><div class="line">    : TestBox(rect, text, appearance, state), mKeyToTest{ keyToTest }</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> KeyTest::doTest(<a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager) </div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(mKeyToTest);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">HasFocusTest::HasFocusTest(<a class="code" href="classbai_1_1_rect.html">RectInt</a> <span class="keyword">const</span> &amp; rect, Appearance <span class="keyword">const</span> &amp; appearance, <span class="keywordtype">bool</span> state)</div><div class="line">    : TestBox(rect, <span class="stringliteral">&quot;Has focus!&quot;</span>, appearance, state)</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> HasFocusTest::doTest(<a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> inputManager.<a class="code" href="classbai_1_1_input_manager.html#a61caafdeb779ca35e8ed8c072856700d">hasFocus</a>();</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">TestManager::~TestManager() </div><div class="line">{</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp; t : mTests) {</div><div class="line">        <span class="keyword">delete</span> t;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TestManager::addTest(TestBox * test) </div><div class="line">{</div><div class="line">    mTests.push_back(test);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> TestManager::test(<span class="keywordtype">float</span> elapsedTime, <a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; inputManager, <a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface) </div><div class="line">{</div><div class="line">    surface.<a class="code" href="classbai_1_1_surface.html#aa28d529e12374c0d25b4e63739c34d82">clear</a>(<a class="code" href="classbai_1_1_color.html#a1ffd2927f6c7ce5ddd8df1af6dcb4ed5">Color::mediumLightGrey</a>);</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp; t : mTests) {</div><div class="line">        t-&gt;test(elapsedTime, inputManager, surface);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span> !((inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::LControl) || inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::RControl)) &amp;&amp; inputManager.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Escape));</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="example3"></a>
Exemple 3</h2>
<p>Ce dernier exemple présente une application simulant des balles. Les classes suivantes :</p><ul>
<li>Ball gérant :<ul>
<li>les informations physique de la balle (modèle)</li>
<li>l'affichage de la balle (view)</li>
<li>un pas de simulation appliquant une physique simple :<ul>
<li>l'application d'un vecteur gravité</li>
<li>le rebondissement de la balle sur les parois de l'application (les balles n'ont pas de collision les unes avec les autres)</li>
</ul>
</li>
<li>des outils pour initialiser aléatoirement tous les paramètres</li>
</ul>
</li>
<li>World gérant :<ul>
<li>plusieurs balles</li>
<li>un pas de simulation</li>
<li>l'affichage du monde</li>
</ul>
</li>
<li>Controler gérant :<ul>
<li>un pas de simulation global</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Exemple avec fonction de rappel liée à un objet</span></div><div class="line"><span class="preprocessor">#include &lt;bai&gt;</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacebai.html">bai</a>;</div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// Fonction utilitaire</span></div><div class="line"><span class="keywordtype">float</span> randomValue(<span class="keywordtype">float</span> minVal, <span class="keywordtype">float</span> maxVal);</div><div class="line"></div><div class="line"><span class="comment">// Classe représentant une balle</span></div><div class="line"><span class="keyword">class </span>Ball</div><div class="line">{</div><div class="line">    <span class="keywordtype">float</span> mRadius{};                    <span class="comment">// Rayon</span></div><div class="line">    <a class="code" href="classbai_1_1_point.html">PointReal</a> mPosition;                <span class="comment">// Position</span></div><div class="line">    <a class="code" href="classbai_1_1_point.html">PointReal</a> mSpeed;                   <span class="comment">// Vitesse</span></div><div class="line">    <a class="code" href="classbai_1_1_color.html">Color</a> mColor;                       <span class="comment">// Couleur</span></div><div class="line">    <span class="keywordtype">float</span> mBouncingCoefficient{};       <span class="comment">// Coefficient de rebondissement</span></div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Constructeur</span></div><div class="line">    Ball(<span class="keywordtype">float</span> radius = 5.0f, <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; pos = <a class="code" href="classbai_1_1_point.html">PointReal</a>(), <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; speed = <a class="code" href="classbai_1_1_point.html">PointReal</a>(), <a class="code" href="classbai_1_1_color.html">Color</a> <span class="keyword">const</span> &amp; color = <a class="code" href="classbai_1_1_color.html#a37fb51e9bc73e6ca628d94a18586db9a">Color::white</a>, <span class="keywordtype">float</span> bounceCoef = 0.99f);</div><div class="line"></div><div class="line">    <span class="comment">// Mutateur global</span></div><div class="line">    <span class="keywordtype">void</span> <span class="keyword">set</span>(<span class="keywordtype">float</span> radius, <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; pos, <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; speed, <a class="code" href="classbai_1_1_color.html">Color</a> <span class="keyword">const</span> &amp; color, <span class="keywordtype">float</span> bounceCoef = 0.99f);</div><div class="line"></div><div class="line">    <span class="comment">// Mutateur aléatoire</span></div><div class="line">    <span class="keywordtype">void</span> randomize(<span class="keywordtype">float</span> maxSpeed, <a class="code" href="classbai_1_1_size.html">SizeInt</a> <span class="keyword">const</span> &amp; worldSize);</div><div class="line"></div><div class="line">    <span class="comment">// Fonction calculant un pas de simulation</span></div><div class="line">    <span class="keywordtype">void</span> tic(<span class="keywordtype">float</span> elaspedTime, <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; gravity, <a class="code" href="classbai_1_1_size.html">SizeInt</a> <span class="keyword">const</span> &amp; worldSize);</div><div class="line"></div><div class="line">    <span class="comment">// Fonction d&#39;affichage</span></div><div class="line">    <span class="keywordtype">void</span> draw(<a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface);</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// Classe représentant le monde</span></div><div class="line"><span class="keyword">class </span>World</div><div class="line">{</div><div class="line">    <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> mTextStyle;               <span class="comment">// Ressource lié au style du texte à afficher</span></div><div class="line">    <a class="code" href="classbai_1_1_size.html">SizeInt</a> mSize;                      <span class="comment">// Taille du monde</span></div><div class="line">    std::vector&lt;Ball&gt; mBalls;           <span class="comment">// Ensemble de balles</span></div><div class="line">    <span class="keywordtype">float</span> mGravityStrength;             <span class="comment">// Amplitude de la gravité</span></div><div class="line">    <span class="keywordtype">bool</span> mGravityActive[4];             <span class="comment">// Activation de la gravité pour les 4 directions</span></div><div class="line">    <a class="code" href="classbai_1_1_point.html">PointReal</a> mGravityVector;           <span class="comment">// Vecteur de gravité</span></div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Constructeur</span></div><div class="line">    World(<a class="code" href="classbai_1_1_size.html">SizeInt</a> <span class="keyword">const</span> &amp; worldSize, <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> <span class="keyword">const</span> &amp; textStyle, <span class="keywordtype">size_t</span> ballCount = 10, <span class="keywordtype">float</span> gravityStrength = 100.0f);</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> setArialFont(<a class="code" href="classbai_1_1_font.html">Font</a> <span class="keyword">const</span> &amp; arialFont);</div><div class="line"></div><div class="line">    <span class="comment">// Mutateur aléatoire pour toutes les balles</span></div><div class="line">    <span class="keywordtype">void</span> randomizeBalls(<span class="keywordtype">float</span> maxSpeed, <a class="code" href="classbai_1_1_size.html">SizeInt</a> <span class="keyword">const</span> &amp; worldSize);</div><div class="line"></div><div class="line">    <span class="comment">// Un pas de simulation</span></div><div class="line">    <span class="keywordtype">void</span> tic(<span class="keywordtype">float</span> elapsedTime);</div><div class="line"></div><div class="line">    <span class="comment">// Fonction d&#39;affichage</span></div><div class="line">    <span class="keywordtype">void</span> draw(<a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface);</div><div class="line"></div><div class="line">    <span class="comment">// Mutateur du vecteur de gravité</span></div><div class="line">    <span class="keywordtype">void</span> setGravity(<span class="keywordtype">bool</span> left, <span class="keywordtype">bool</span> up, <span class="keywordtype">bool</span> right, <span class="keywordtype">bool</span> down);</div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Classe réalisant la gestion du programme</span></div><div class="line"><span class="keyword">class </span>Controller</div><div class="line">{</div><div class="line">    World &amp; mWorld;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Constructeur</span></div><div class="line">    Controller(World &amp; world);</div><div class="line"></div><div class="line">    <span class="comment">// Pas de simulation</span></div><div class="line">    <span class="keywordtype">bool</span> tic(<span class="keywordtype">float</span> elapsedTime, <a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; reader, <a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface);</div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Point d&#39;entrée du programme</span></div><div class="line"><span class="comment"></span><span class="keywordtype">int</span> WinMain()</div><div class="line">{</div><div class="line">    <span class="comment">// Taille de la scène</span></div><div class="line">    <a class="code" href="classbai_1_1_size.html">SizeInt</a> worldSize(1024, 768);</div><div class="line"></div><div class="line">    <span class="comment">// BAI</span></div><div class="line">    <span class="comment">// Pour cet exemple, les 2 ressources indiquées doivent être disponibles dans le dossier d&#39;exécution.</span></div><div class="line">    <a class="code" href="classbai_1_1_basic_application_interface.html">BasicApplicationInterface</a> app(worldSize.width(), worldSize.height(), <span class="stringliteral">&quot;Bouncing balls&quot;</span>, <span class="stringliteral">&quot;ball.png&quot;</span>);</div><div class="line">    <a class="code" href="classbai_1_1_font.html">Font</a> arialFont(<span class="stringliteral">&quot;arial.ttf&quot;</span>);</div><div class="line">    <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> textStyle(arialFont, 46, <a class="code" href="classbai_1_1_color.html#a1a4a018bb89c1aa1e284aa0e8169c8b1">Color::veryDarkGrey</a>);</div><div class="line"></div><div class="line">    <span class="comment">// Monde</span></div><div class="line">    World world(worldSize, textStyle, 50, 1000.0f);</div><div class="line">    world.randomizeBalls(100.0f, worldSize);</div><div class="line">    <span class="comment">// Contrôleur</span></div><div class="line">    Controller controller(world);</div><div class="line"></div><div class="line">    app.registerLoop(controller, &amp;Controller::tic);</div><div class="line">    app.run();</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Implémentation des fonctions</span></div><div class="line"><span class="comment"></span><span class="keywordtype">float</span> randomValue(<span class="keywordtype">float</span> minVal, <span class="keywordtype">float</span> maxVal)</div><div class="line">{</div><div class="line">    std::random_device randomDevice;</div><div class="line">    std::default_random_engine randomEngine(randomDevice());</div><div class="line">    <span class="keywordflow">return</span> std::uniform_real_distribution&lt;float&gt;(minVal, maxVal)(randomEngine);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">Ball::Ball(<span class="keywordtype">float</span> radius, <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; pos, <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; speed, <a class="code" href="classbai_1_1_color.html">Color</a> <span class="keyword">const</span> &amp; color, <span class="keywordtype">float</span> bounceCoef)</div><div class="line">    : mRadius{ radius }, mPosition(pos), mSpeed(speed), mBouncingCoefficient{ bounceCoef }, mColor(color)</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> Ball::set(<span class="keywordtype">float</span> radius, <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; pos, <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; speed, <a class="code" href="classbai_1_1_color.html">Color</a> <span class="keyword">const</span> &amp; color, <span class="keywordtype">float</span> bounceCoef)</div><div class="line">{</div><div class="line">    mRadius = radius;</div><div class="line">    mPosition = pos;</div><div class="line">    mSpeed = speed;</div><div class="line">    mBouncingCoefficient = bounceCoef;</div><div class="line">    mColor = color;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> Ball::randomize(<span class="keywordtype">float</span> maxSpeed, <a class="code" href="classbai_1_1_size.html">SizeInt</a> <span class="keyword">const</span> &amp; worldSize)</div><div class="line">{</div><div class="line">    mRadius = randomValue(5.0f, 17.5f);</div><div class="line">    mPosition.randomize(mRadius, worldSize.width() - mRadius, mRadius, worldSize.height() - mRadius);</div><div class="line">    mSpeed.randomize(-maxSpeed, maxSpeed, -maxSpeed, maxSpeed);</div><div class="line">    mBouncingCoefficient = randomValue(0.70f, 0.90f);</div><div class="line">    mColor.<a class="code" href="classbai_1_1_color.html#a7f1e57a773405c5c3d36bbe838c0ef81">randomize</a>(128, 255, <span class="keyword">true</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> Ball::tic(<span class="keywordtype">float</span> elaspedTime, <a class="code" href="classbai_1_1_point.html">PointReal</a> <span class="keyword">const</span> &amp; gravity, <a class="code" href="classbai_1_1_size.html">SizeInt</a> <span class="keyword">const</span> &amp; worldSize) {</div><div class="line">    <span class="comment">// Applique le vecteur de gravité</span></div><div class="line">    mPosition = mPosition + mSpeed * elaspedTime + 0.5f * gravity * elaspedTime * elaspedTime;</div><div class="line">    mSpeed = mSpeed + gravity * elaspedTime;</div><div class="line"></div><div class="line">    <span class="comment">// Gère les collisions avec la paroi de l&#39;application</span></div><div class="line">    <span class="keywordflow">if</span> (mPosition.x() &lt; mRadius) {</div><div class="line">        mPosition.setX(2.0f * mRadius - mPosition.x());</div><div class="line">        mSpeed.setX(-mSpeed.x() * mBouncingCoefficient);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (mPosition.x() &gt;= worldSize.width() - mRadius) {</div><div class="line">        mPosition.setX(2.0f * (worldSize.width() - mRadius) - mPosition.x());</div><div class="line">        mSpeed.setX(-mSpeed.x() * mBouncingCoefficient);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (mPosition.y() &lt; mRadius) {</div><div class="line">        mPosition.setY(2.0f * mRadius - mPosition.y());</div><div class="line">        mSpeed.setY(-mSpeed.y() * mBouncingCoefficient);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (mPosition.y() &gt;= worldSize.height() - mRadius) {</div><div class="line">        mPosition.setY(2.0f * (worldSize.height() - mRadius) - mPosition.y());</div><div class="line">        mSpeed.setY(-mSpeed.y() * mBouncingCoefficient);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> Ball::draw(<a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface) {</div><div class="line">    surface.<a class="code" href="classbai_1_1_surface.html#a8889a9495cae60c6bb60705fb10639bb">drawCircle</a>(mPosition, mRadius, mColor);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">World::World(<a class="code" href="classbai_1_1_size.html">SizeInt</a> <span class="keyword">const</span> &amp; worldSize, <a class="code" href="classbai_1_1_text_style.html">TextStyle</a> <span class="keyword">const</span> &amp; textStyle, <span class="keywordtype">size_t</span> ballCount, <span class="keywordtype">float</span> gravityStrength)</div><div class="line">    : mSize(worldSize), mTextStyle(textStyle), mBalls(ballCount), mGravityStrength{ gravityStrength }, mGravityVector()</div><div class="line">{}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> World::randomizeBalls(<span class="keywordtype">float</span> maxSpeed, <a class="code" href="classbai_1_1_size.html">SizeInt</a> <span class="keyword">const</span> &amp; worldSize) {</div><div class="line">    std::for_each(mBalls.begin(), mBalls.end(), [&amp;](Ball &amp; ball) { ball.randomize(maxSpeed, worldSize); });</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> World::tic(<span class="keywordtype">float</span> elapsedTime) {</div><div class="line">    std::for_each(mBalls.begin(), mBalls.end(), [<span class="keyword">this</span>, elapsedTime](Ball &amp; ball) { ball.tic(elapsedTime, mGravityVector, mSize); });</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> World::draw(<a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface) {</div><div class="line">    surface.<a class="code" href="classbai_1_1_surface.html#aa28d529e12374c0d25b4e63739c34d82">clear</a>(<a class="code" href="classbai_1_1_color.html#a2285200634eb541c0750b4a35a01ff71">Color::black</a>);</div><div class="line">    <span class="keywordtype">float</span> gravLengthIndic{ 200.0f };</div><div class="line">    <a class="code" href="classbai_1_1_color.html">Color</a> gravColorFill(0, 0, 48);</div><div class="line">    <a class="code" href="classbai_1_1_color.html">Color</a> gravColorOutline(0, 0, 128);</div><div class="line">    <span class="keywordflow">if</span> (mGravityActive[0]) surface.<a class="code" href="classbai_1_1_surface.html#a19b7fc046d752c99b60376f6561340a0">drawRegularPolygon</a>(<a class="code" href="classbai_1_1_point.html">PointReal</a>(gravLengthIndic, surface.<a class="code" href="classbai_1_1_surface.html#a899b0e3c67ce384e5b491883924b4e03">height</a>() / 2.0f), gravLengthIndic, 3, -90.0f, gravColorFill, gravColorOutline);</div><div class="line">    <span class="keywordflow">if</span> (mGravityActive[2]) surface.<a class="code" href="classbai_1_1_surface.html#a19b7fc046d752c99b60376f6561340a0">drawRegularPolygon</a>(<a class="code" href="classbai_1_1_point.html">PointReal</a>(surface.<a class="code" href="classbai_1_1_surface.html#adec7a5d98c6d1c03915b9b45038d57f9">width</a>() - gravLengthIndic, surface.<a class="code" href="classbai_1_1_surface.html#a899b0e3c67ce384e5b491883924b4e03">height</a>() / 2.0f), gravLengthIndic, 3, 90.0f, gravColorFill, gravColorOutline);</div><div class="line">    <span class="keywordflow">if</span> (mGravityActive[1]) surface.<a class="code" href="classbai_1_1_surface.html#a19b7fc046d752c99b60376f6561340a0">drawRegularPolygon</a>(<a class="code" href="classbai_1_1_point.html">PointReal</a>(surface.<a class="code" href="classbai_1_1_surface.html#adec7a5d98c6d1c03915b9b45038d57f9">width</a>() / 2.0f, gravLengthIndic), gravLengthIndic, 3, 0.0f, gravColorFill, gravColorOutline);</div><div class="line">    <span class="keywordflow">if</span> (mGravityActive[3]) surface.<a class="code" href="classbai_1_1_surface.html#a19b7fc046d752c99b60376f6561340a0">drawRegularPolygon</a>(<a class="code" href="classbai_1_1_point.html">PointReal</a>(surface.<a class="code" href="classbai_1_1_surface.html#adec7a5d98c6d1c03915b9b45038d57f9">width</a>() / 2.0f, surface.<a class="code" href="classbai_1_1_surface.html#a899b0e3c67ce384e5b491883924b4e03">height</a>() - gravLengthIndic), gravLengthIndic, 3, 180.0f, gravColorFill, gravColorOutline);</div><div class="line"></div><div class="line">    surface.<a class="code" href="classbai_1_1_surface.html#a21bf2906a4f062c434a4931c50fa2f5a">drawCenteredText</a>(mTextStyle, <span class="stringliteral">&quot;Apply gravity by pressing any arrow&quot;</span>, mSize.center(), 0.0f);</div><div class="line">    std::for_each(mBalls.begin(), mBalls.end(), [&amp;surface](Ball &amp; ball) { ball.draw(surface); });</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> World::setGravity(<span class="keywordtype">bool</span> left, <span class="keywordtype">bool</span> up, <span class="keywordtype">bool</span> right, <span class="keywordtype">bool</span> down) {</div><div class="line">    mGravityActive[0] = left;</div><div class="line">    mGravityActive[1] = up;</div><div class="line">    mGravityActive[2] = right;</div><div class="line">    mGravityActive[3] = down;</div><div class="line">    mGravityVector.setX((<span class="keywordtype">int</span>)left * -mGravityStrength + (<span class="keywordtype">int</span>)right * mGravityStrength);</div><div class="line">    mGravityVector.setY((<span class="keywordtype">int</span>)up * -mGravityStrength + (<span class="keywordtype">int</span>)down * mGravityStrength);</div><div class="line">}</div><div class="line"></div><div class="line">Controller::Controller(World &amp; world) </div><div class="line">    : mWorld{ world } </div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Pas de simulation</span></div><div class="line"><span class="keywordtype">bool</span> Controller::tic(<span class="keywordtype">float</span> elapsedTime, <a class="code" href="classbai_1_1_input_manager.html">InputManager</a> &amp; reader, <a class="code" href="classbai_1_1_surface.html">Surface</a> &amp; surface) {</div><div class="line">    <span class="comment">// Lecture des entrées</span></div><div class="line">    <span class="keywordtype">bool</span> left{ reader.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Left) };</div><div class="line">    <span class="keywordtype">bool</span> up{ reader.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Up) };</div><div class="line">    <span class="keywordtype">bool</span> right{ reader.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Right) };</div><div class="line">    <span class="keywordtype">bool</span> down{ reader.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Down) };</div><div class="line">    <span class="keywordtype">bool</span> quit{ reader.<a class="code" href="classbai_1_1_input_manager.html#a928eefb5b2eda9ed501d33bc41426fb1">isKeyPressed</a>(InputManager::Key::Q) };</div><div class="line"></div><div class="line">    <span class="comment">// Modifie le modèle </span></div><div class="line">    mWorld.setGravity(left, up, right, down);</div><div class="line">    mWorld.tic(elapsedTime);</div><div class="line"></div><div class="line">    <span class="comment">// Affiche le modèle</span></div><div class="line">    mWorld.draw(surface);</div><div class="line"></div><div class="line">    <span class="comment">// Est-ce que l&#39;usager désire poursuivre?</span></div><div class="line">    <span class="keywordflow">return</span> !quit;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
